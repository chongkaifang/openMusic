<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>çƒ­é—¨ä¸“è¾‘</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/audio.css">
    <link rel="stylesheet" href="../../css/base.css">
    <style>
        [v-cloak] {
            display: none;
        }
        .nav-item:hover {
            background-color: #99ccff;
        }

        .nav-active {
            background-color: #99ccff;
        }

        .v-hd2 {
            height: 40px;
            line-height: 40px;
            padding: 0 10px 0 10px;
            font-size: 16px;
        }

        .el-input {
            margin-left: 10px;
        }

        .el-input__inner, .el-input__icon {
            height: 30px;
            line-height: 30px;
        }
        .el-menu-item {
            overflow-x: hidden;
            overflow-y: hidden;
        }
        .el-menu-item {
            height: 45px;
            line-height: 45px;
        }
        .el-menu-item.is-active {
            background-color: #bfeeff !important;
        }
    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <el-row>
        <div style="background-color: #0080ff; width: 100%; height: 60px;">
            <el-col :span="6">
                <!-- å¯¼èˆª -->
                <div style="height: 60px; line-height: 60px; color: white; text-align: center;">
                    <div style="padding: 0 20px; cursor: pointer">
                        <a style="color: white; font-size: 23px" href="/page/front/index.html">éŸ³ä¹ç•…æ¸¸å¹¿åœº</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="12">
                <!-- å¯¼èˆª -->
                <div style="height: 60px; line-height: 60px; color: white; display: flex; justify-content : flex-start;">
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/index.html">é¦–é¡µ</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item nav-active">
                        <a style="color: white" href="/page/front/album.html">çƒ­é—¨ä¸“è¾‘</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/song.html">çƒ­é—¨æ­Œæ›²</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/songlist.html">æ­Œå•åˆ—è¡¨</a>
                    </div>
                    <div v-if="user && user.userId" style="padding: 0 20px; cursor: pointer" class="nav-item">
                        <a style="color: white" href="/page/end/index.html">ä¸ªäººä¸­å¿ƒ</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="6">
                <div style="line-height: 60px; text-align: right">
                    <div style="margin-right: 20px">
                        <el-dropdown v-if="user && user.userId">
                            <img :src=`/files/${user.userAvatar}`
                                 style="width: 40px; height: 40px; margin-right: 10px; border-radius: 50%">
                            <el-dropdown-menu slot="dropdown">
                                <a href="/page/end/person.html"
                                   style="display:inline-block; padding: 5px 0; width: 100px; text-align: center; color: black">ä¸ªäººä¿¡æ¯</a>
                                <a @click="logout" href="#"
                                   style="display:block; width: 100px;  text-align: center; color: black">é€€å‡º</a>
                            </el-dropdown-menu>
                        </el-dropdown>
                        <a v-else href="/page/end/login.html" style="margin-right: 30px; font-size: 15px; color: white">ç™»å½•</a>
                    </div>

                </div>

            </el-col>
        </div>
    </el-row>

    <el-row type="flex" justify="center" style="margin-top: 20px">
        <el-col :span="3">
            <el-menu
                    :default-active="index"
                    text-color="#555"
                    active-text-color="#169af3">
                <el-menu-item
                        :index="item.albumId"
                        :key="item.albumId"
                        v-for="(item,index) in albums"
                        @click="loadSongData(item.albumId)"
                >
                    <img :src=`/files/${item.albumImg}` style="width: 18px; height: 18px">
                    <span style="margin-left: 10px; font-size: 14px;">{{item.albumName}}</span>
                </el-menu-item>
            </el-menu>
        </el-col>
        <el-col :span="12" offset="1">
            <div class="v-hd2" style="display: inline-block">
                ä¸“è¾‘å†…å•æ›²
            </div>
            <div style="display: inline-block; float: right">
                <el-button
                        type="success"
                        round size="small"
                        @click="toggleSelection()"
                >åŠ å…¥æ­Œå•
                </el-button>
            </div>
            <div style="border-bottom: 2px solid #ccc; margin-top: 5px"></div>
            <el-table
                    :data="songData"
                    style="width: 100%"
                    size="small"
                    @selection-change="handleSelectionChange"
            >
                <el-table-column
                        type="selection"
                        align="center"
                        width="50">
                </el-table-column>
                <el-table-column
                        label="æ­Œæ›²åç§°"
                        align="center"
                >
                    <template slot-scope="scope">
                        <a :href=`/page/front/songDetail.html?id=${scope.row.songId}`>{{scope.row.songName}}</a>
                    </template>
                </el-table-column>
                <el-table-column
                        prop="songSinger"
                        label="ä½œæ›²äºº"
                        align="center"
                >
                </el-table-column>
                <el-table-column
                        prop="songLyricist"
                        label="ä½œè¯äºº"
                        align="center"
                >
                </el-table-column>
                </el-table-column>
                <el-table-column
                        prop="songHot"
                        label="çƒ­åº¦ğŸ”¥"
                        align="center"
                >
                </el-table-column>

            </el-table>
        </el-col>
    </el-row>
    <el-dialog title="é€‰æ‹©ä½ è¦åŠ å…¥çš„æ­Œå•" :visible.sync="dialogFormVisible" width="30%">
        <el-form :model="form">
            <el-form-item label="æ­Œå•é€‰æ‹©" label-width="120px">
                <el-select v-model="form.listId" placeholder="è¯·é€‰æ‹©ä½ çš„æ­Œå•">
                    <el-option v-for="item in list" :label="item.songListName" :value="item.songListId"></el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">å– æ¶ˆ</el-button>
            <el-button type="primary" @click="addSongList">ç¡® å®š</el-button>
        </div>
    </el-dialog>
</div>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<script src="../../js/audio.js"></script>
<script>
    new Vue({
        el: "#wrapper",
        data: {
            user: {},
            dialogFormVisible: false,
            form: {},
            // å½“å‰ç”¨æˆ·æ­Œå•
            list: [],
            // é€‰ä¸­èœå•ï¼Œå³ä¸“è¾‘id
            index: 0,
            // ä¸“è¾‘å†…çš„æ­Œæ›²
            songData: [],
            // ä¸“è¾‘åˆ—è¡¨
            albums: [],
            // é€‰ä¸­å¾…åŠ å…¥æ­Œå•çš„æ­Œæ›²
            multipleSelection: []
        },
        created() {
            this.getUser();
            this.index = getUrlParamValue('id');
            this.loadZhuanjiData();
        },
        methods: {
            getUser() {
                $.get("/user/session").then(res => {
                    if (res.code === '0') {
                        this.user = res.data;
                        // åŠ è½½å½“å‰ç”¨æˆ·æ­Œå•ä¿¡æ¯
                        $.get("/songList/user/" + this.user.userId).then(res => {
                            if (res.code === '0') {
                                this.list = res.data;
                            } else {
                                this.$message({
                                    type: "warning",
                                    message: res.msg,
                                });
                            }
                        })
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            loadZhuanjiData() {
                $.get("/album").then(res => {
                    if (res.code === '0') {
                        this.albums = res.data;
                        this.index = this.index === 0 ? this.albums[0].albumId : this.index;
                        // åŠ è½½å³ä¾§æ­Œæ›²ä¿¡æ¯
                        this.loadSongData(this.index);
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            loadSongData(albumId) {
                $.get("/song/album/" + albumId).then(res => {
                    if (res.code === '0') {
                        this.songData = res.data;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                });
                $.get("/album/updateHot/" + albumId);
            },
            // è®°å½•é€‰ä¸­çš„å¾…åŠ å…¥æ­Œå•çš„å•æ›²
            handleSelectionChange(val) {
                this.multipleSelection = val;
            },
            // å¼¹å‡ºåŠ å…¥æ­Œå•çª—å£
            toggleSelection(rows) {
                // å…ˆåˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œæœªç™»å½•æç¤ºç™»å½•
                if (!this.user) {
                    this.$message({
                        type: "warning",
                        message: 'è¯·å…ˆç™»å½•',
                    });
                    return;
                }
                // åˆ¤æ–­æœ‰æ²¡æœ‰é€‰æ‹©æ­Œæ›²
                if (this.multipleSelection.length === 0) {
                    this.$message({
                        type: "warning",
                        message: 'è¯·é€‰æ‹©è¦åŠ å…¥çš„æ­Œæ›²',
                    });
                    return;
                }
                // å¼¹å‡ºçª—å£è®©ç”¨æˆ·é€‰æ‹©è‡ªå·±çš„æ­Œå•
                this.dialogFormVisible = true;
            },
            // åŠ å…¥æ­Œå•
            addSongList() {
                this.dialogFormVisible = false;
                this.form.songList = this.multipleSelection;
                $.ajax({
                    url: '/songListRel',
                    type: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify(this.form)
                }).then(res => {
                    if (res.code === '0') {
                        this.$message({
                            message: "æ·»åŠ æˆåŠŸ",
                            type: "success"
                        });
                        this.loadTable();
                    } else {
                        this.$message({
                            message: res.msg,
                            type: "error"
                        })
                    }
                })
            },
            logout() {
                $.get("/user/logout");
                this.user = {};
            },
        }
    });

    /**
     * è·å–urlå‚æ•°
     * @param name
     * @returns {string|null}
     */
    function getUrlParamValue(name) {
        if (name == null || name === 'undefined') {
            return 0;
        }
        let searchStr = decodeURI(location.search);
        let infoIndex = searchStr.indexOf(name + "=");
        if (infoIndex === -1) {
            return 0;
        }
        let searchInfo = searchStr.substring(infoIndex + name.length + 1);
        let tagIndex = searchInfo.indexOf("&");
        if (tagIndex !== -1) {
            searchInfo = searchInfo.substring(0, tagIndex);
        }
        return searchInfo;
    }
</script>
</body>
</html>
