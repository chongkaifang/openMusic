<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="../../css/element.css">
<!--    <link rel="stylesheet" href="../../css/audio.css">-->
    <link rel="stylesheet" href="../../css/base.css">
    <style>
        [v-cloak] {
            display: none;
        }

        .nav-item:hover {
            background-color: #8bc99f;
        }

        .nav-active {
            background-color: #8bc99f;
        }

        .v-hd2 {
            height: 40px;
            padding: 0 10px 0 10px;
            font-size: 16px;
            border-bottom: 2px solid #C10D0C;
        }

        .el-input {
            width: 200px;
        }

        .el-input__inner, .el-input__icon {
            height: 30px;
            line-height: 30px;
        }
    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <el-row>
        <div style="background-color: #7eab7b; width: 100%; height: 60px;">
            <el-col :span="6">
                <!-- 导航 -->
                <div style="height: 60px; line-height: 60px; color: white; text-align: center;">
                    <div style="padding: 0 20px; cursor: pointer">
                        <a style="color: white; font-size: 23px" href="/page/front/index.html">时代音乐小站</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="12">
                <!-- 导航 -->
                <div style="height: 60px; line-height: 60px; color: white; display: flex; justify-content : flex-start;">
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item nav-active">
                        <a style="color: white" href="/page/front/index.html">首页</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/zhuanji.html">热门专辑</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/song.html">热门歌曲</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/songlist.html">歌单列表</a>
                    </div>
                    <div v-if="user && user.id" style="padding: 0 20px; cursor: pointer" class="nav-item">
                        <a style="color: white" href="/page/end/index.html">个人中心</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="6">
                <div style="line-height: 60px; text-align: right;">
                    <div style="margin-right: 20px;">
                        <el-input v-model="search" prefix-icon="el-icon-search" row="8" placeholder="请输入内容"></el-input>
                        <el-button type="warning" size="small" @click="clickSearch()" style="margin-right: 20px">搜索</el-button>
                        <el-dropdown v-if="user && user.id">
                            <img :src=`/files/${user.avatar}`
                                 style="width: 40px; height: 40px; margin-right: 10px; border-radius: 50%">
                            <el-dropdown-menu slot="dropdown">
                                <a href="/page/end/person.html"
                                   style="display:inline-block; padding: 5px 0; width: 100px; text-align: center; color: black">个人信息</a>
                                <a @click="logout" href="#"
                                   style="display:block; width: 100px;  text-align: center; color: black">退出</a>
                            </el-dropdown-menu>
                        </el-dropdown>
                        <a v-else href="/page/end/login.html" style="margin-right: 30px; font-size: 15px; color: white">登录</a>
                    </div>

                </div>


            </el-col>
        </div>
    </el-row>

    <el-row>
        <el-col :span="24">
            <!-- 轮播图 -->
            <div>
                <el-carousel height="400px">
                    <el-carousel-item v-for="item in 4" :key="item">
                        <a>
                            <img :src=`/images/carousel/${item}.jpg` alt="" style="width: 100%; height: 100%">
                        </a>
                    </el-carousel-item>
                </el-carousel>
            </div>
        </el-col>
    </el-row>

    <el-row type="flex" justify="center" style="margin: 30px 0">
        <el-col :span="10" style="margin-right: 25px">
            <el-row type="flex" justify="center" align="middle">
                <el-col :span="12">
                    <span class="main-font">歌单列表</span>
                </el-col>
                <el-col :span="12" style="text-align: right" >
                    <a href="/page/front/songlist.html" class="more">更多 ></a>
                </el-col>
            </el-row>
            <el-row gutter="30" style="margin-top: 20px">
                <el-col :span="12">
                    <div>
                        <a :href=`/page/front/songlistDetail.html?id=${songList[0].id}` target="_blank">
                            <img :src=`/files/${songList[0].img}` style="width: 100%; border-radius: 10px">
                        </a>
                        <div style="margin-top: 10px">
                            <span class="font-item">{{songList[0].name}}</span>
                        </div>
                    </div>
                </el-col>
                <el-col :span="12">
                    <el-row gutter="25" justify="center" align="middle">
                        <el-col :span="12">
                            <div>
                                <a :href=`/page/front/songlistDetail.html?id=${songList[1].id}` target="_blank">
                                    <img :src=`/files/${songList[1].img}` style="width: 100%; border-radius: 10px">
                                </a>
                                <div style="margin: 10px">
                                    <span class="font-item">{{songList[1].name}}</span>
                                </div>
                            </div>
                        </el-col>
                        <el-col :span="12">
                            <div>
                                <a :href=`/page/front/songlistDetail.html?id=${songList[2].id}` target="_blank">
                                    <img :src=`/files/${songList[2].img}` style="width: 100%; border-radius: 10px">
                                </a>
                                <div style="margin: 10px 0">
                                    <span class="font-item">{{songList[2].name}}</span>
                                </div>
                            </div>
                        </el-col>
                    </el-row>
                    <el-row gutter="25">
                        <el-col :span="12">
                            <div>
                                <a :href=`/page/front/songlistDetail.html?id=${songList[3].id}` target="_blank">
                                    <img :src=`/files/${songList[3].img}` style="width: 100%; border-radius: 10px">
                                </a>
                                <div style="margin-top: 10px">
                                    <span class="font-item">{{songList[3].name}}</span>
                                </div>
                            </div>
                        </el-col>
                        <el-col :span="12">
                            <div>
                                <a :href=`/page/front/songlistDetail.html?id=${songList[4].id}` target="_blank">
                                    <img :src=`/files/${songList[4].img}` style="width: 100%; border-radius: 10px">
                                </a>
                                <div style="margin-top: 10px">
                                    <span class="font-item">{{songList[4].name}}</span>
                                </div>
                            </div>
                        </el-col>
                    </el-row>
                </el-col>
            </el-row>
        </el-col>
        <el-col :span="5" style="margin-left: 25px">
            <el-row type="flex" justify="center" align="middle">
                <el-col :span="12">
                    <span class="main-font">热门专辑</span>
                </el-col>
                <el-col :span="12" style="text-align: right" >
                    <a href="/page/front/zhuanji.html" class="more">更多 ></a>
                </el-col>
            </el-row>
            <el-row gutter="30" algin="middle" v-for="zhuanji in zhuanjis" style="margin-top: 20px">
                <el-col :span="9">
                    <a :href=`/page/front/zhuanji.html?id=${zhuanji.id}` target="_blank">
                        <img :src="'/files/' + zhuanji.img" style="width: 100%; border-radius: 10px; border-style: solid; border-width: 2px; border-color:#ccc">
                    </a>
                </el-col>
                <el-col :span="15">
                    <div v-for="(item,index) in zhuanji.songList" style="margin-top: 5px">
                        <a :href=`/page/front/songDetail.html?id=${item.id}` target="_blank" style="text-decoration: none; ">
                            <span class="zhuanji-tem-font"><span>{{index + 1}}.</span> {{item.name}}</span>
                        </a>
                    </div>
                </el-col>
            </el-row>
        </el-col>
    </el-row>

    <el-row type="flex" justify="center" style="margin: 40px 0">
        <el-col :span="16">
            <el-row type="flex" justify="center" align="middle">
                <el-col :span="12">
                    <span class="main-font">热门歌手</span>
                </el-col>
                <el-col :span="12" style="text-align: right" >
                    <a href="#" class="more">更多 ></a>
                </el-col>
            </el-row>
            <el-row type="flex" :gutter="40" justify="center" style="margin-top: 30px">
                <el-col :span="4" v-for="item in singers">
                    <div>
                        <a :href=`/page/front/singer.html?id=${item.id}` target="_blank">
                            <img :src="'/files/' + item.img" style="width: 100%; border-radius: 100px">
                        </a>
                        <div style="margin-top: 15px; text-align: center">
                            <span class="font-item">{{item.name}}</span>
                        </div>
                    </div>
                </el-col>
            </el-row>
        </el-col>
    </el-row>

    <el-dialog title="歌单" :visible.sync="dialogFormVisible" width="20%" top="30vh"
               close-on-click-modal="false" close-on-press-escape="false" show-close="false">
        <el-form>
            <el-form-item label="歌单" label-width="70px">
                <el-select v-model="entity.listId" placeholder="请选择">
                    <el-option
                            v-for="item in options"
                            :key="item.id"
                            :label="item.name"
                            :value="item.id">
                    </el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="save">确 定</el-button>
        </div>
    </el-dialog>

</div>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<!--<script src="../../js/audio.js"></script>-->
<script>

    function subStr(str,length){
        let a = str.match(/[^\x00\xff]|\w{1,2}/g);
        return a.length <= length ? str : a.slice(0,length).join("")+"...";
    }

    new Vue({
        el: "#wrapper",
        data: {
            user: {},
            tableData: [],
            search: '',
            selectValue: '',
            entity: {},
            dialogFormVisible: false,
            options: [],
            songList: [],
            singers: [],
            zhuanjis: [],
        },
        created() {
            this.getUser();
            this.loadHotSongList();
            this.loadHotSingerList();
            this.loadHotZhuanjiList();
        },
        mounted() {
            // 初始化播放器
            // this.initAudio();
        },
        methods: {
            clickSearch() {
                location.href = '/page/front/song.html?name=' + this.search;
            },
            getUser() {
                $.get("/user/session").then(res => {
                    if (res.code === '0') {
                        this.user = res.data;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            collect(songId) {
                if (!this.user || !this.user.username) {
                    location.href = "../end/login.html";
                    return;
                }
                this.entity.songId = songId;
                this.dialogFormVisible = true;
            },
            loadTable() {
                $.get("/song/page?name=" + this.search).then(res => {
                    if (res.code === '0') {

                    }
                });

                if (this.user && this.user.id) {
                    $.get("/songList/user/" + this.user.id).then(res => {
                        if(res.code === '0') {
                            this.options = res.data;
                        }
                    })
                }
            },
            loadHotSongList() {
                $.get("/songList/hot").then(res => {
                    if (res.code === '0') {
                        let list = [];
                        // 截取字符串
                        res.data.forEach(item => {
                            item.name = subStr(item.name, 9);
                            list.push(item);
                        });
                        this.songList = list;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                });
            },
            loadHotSingerList() {
                $.get("/singer/hot").then(res => {
                    if (res.code === '0') {
                        this.singers = res.data;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                });
            },
            loadHotZhuanjiList() {
                $.get("/zhuanji/hot").then(res => {
                    if (res.code === '0') {
                        this.zhuanjis = res.data;
                        this.zhuanjis.forEach(item => {
                            item.songList.forEach(song => {
                                song.name = subStr(song.composer + ' - ' + song.name, 13)
                            })
                        })
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                });
            },
            logout() {
                $.get("/user/logout");
                this.user = {};
            },
            save() {
                if (!this.entity.listId) {
                    this.$message({
                        type: "warning",
                        message: "请选择歌单",
                    });
                    return;
                }
                $.ajax({
                    url: '/songListRel',
                    contentType: "application/json",
                    type: 'POST',
                    data: JSON.stringify(this.entity)
                }).then(res => {
                    if (res.code === "0") {
                        this.$message({
                            type: "success",
                            message: "收藏成功",
                            duration: 500
                        });
                        this.loadTable();
                        this.dialogFormVisible = false;
                        this.entity = {};
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
        }
    })
</script>
</body>
</html>
