<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>çƒ­é—¨æ­Œæ‰‹</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/audio.css">
    <link rel="stylesheet" href="../../css/base.css">
    <style>
        [v-cloak] {
            display: none;
        }
        .nav-item:hover {
            background-color: #8bc99f;
        }

        .nav-active {
            background-color: #8bc99f;
        }

        .v-hd2 {
            height: 40px;
            line-height: 40px;
            padding: 0 10px 0 10px;
            font-size: 16px;
        }

        .el-input {
            margin-left: 10px;
        }

        .el-input__inner, .el-input__icon {
            height: 30px;
            line-height: 30px;
        }
        .el-menu-item {
            overflow-x: hidden;
            overflow-y: hidden;
        }
        .el-menu-item.is-active {
            background-color: #bfeeff !important;
        }
    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <el-row>
        <div style="background-color: #7eab7b; width: 100%; height: 60px;">
            <el-col :span="6">
                <!-- å¯¼èˆª -->
                <div style="height: 60px; line-height: 60px; color: white; text-align: center;">
                    <div style="padding: 0 20px; cursor: pointer">
                        <a style="color: white; font-size: 23px" href="/page/front/index.html">æ—¶ä»£éŸ³ä¹å°ç«™</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="12">
                <!-- å¯¼èˆª -->
                <div style="height: 60px; line-height: 60px; color: white; display: flex; justify-content : flex-start;">
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/index.html">é¦–é¡µ</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/zhuanji.html">çƒ­é—¨ä¸“è¾‘</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/song.html">çƒ­é—¨æ­Œæ›²</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/songlist.html">æ­Œå•åˆ—è¡¨</a>
                    </div>
                    <div v-if="user && user.id" style="padding: 0 20px; cursor: pointer" class="nav-item">
                        <a style="color: white" href="/page/end/index.html">ä¸ªäººä¸­å¿ƒ</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="6">
                <div style="line-height: 60px; text-align: right">
                    <div style="margin-right: 20px">
                        <el-dropdown v-if="user && user.id">
                            <img :src=`/files/${user.avatar}`
                                 style="width: 40px; height: 40px; margin-right: 10px; border-radius: 50%">
                            <el-dropdown-menu slot="dropdown">
                                <a href="/page/end/person.html"
                                   style="display:inline-block; padding: 5px 0; width: 100px; text-align: center; color: black">ä¸ªäººä¿¡æ¯</a>
                                <a @click="logout" href="#"
                                   style="display:block; width: 100px;  text-align: center; color: black">é€€å‡º</a>
                            </el-dropdown-menu>
                        </el-dropdown>
                        <a v-else href="/page/end/login.html" style="margin-right: 30px; font-size: 15px; color: white">ç™»å½•</a>
                    </div>

                </div>

            </el-col>
        </div>
    </el-row>

    <el-row type="flex" justify="center" style="margin-top: 20px">
        <el-col :span="3" style="border-right: 1px solid #cccccc">
            <img :src=`/files/${singer.img}` style="width: 150px">
            <div style="font-size: 13px; color: #666; padding-top: 20px">å§“åï¼š{{singer.name}}</div>
            <div style="font-size: 13px; color: #666; padding-top: 5px">æ€§åˆ«ï¼š {{singer.sex}}</div>
            <div style="font-size: 13px; color: #666; padding-top: 5px">å‡ºç”Ÿï¼š {{singer.age}}</div>
            <div style="font-size: 13px; color: #666; padding-top: 5px">æ¥è‡ªï¼š{{singer.comeFrom}}</div>
            <div style="font-size: 13px; color: #666; padding-top: 5px; margin-right: 30px">ä»£è¡¨ä½œï¼š{{singer.works}}</div>
            <div style="font-size: 13px; color: #666; padding-top: 15px">æ­Œæ‰‹ç®€ä»‹ï¼š</div>
            <div style="font-size: 13px; color: #666; margin-top: 10px; margin-right: 30px">{{singer.introduction}}</div>
        </el-col>
        <el-col :span="12" offset="1">
            <div class="v-hd2" style="display: inline-block">
                æ­Œæ›²åˆ—è¡¨
            </div>
            <div style="display: inline-block; float: right">
                <el-button
                        round
                        size="small"
                        type="success"
                        @click="toggleSelection()"
                >
                    åŠ å…¥æ­Œå•
                </el-button>
            </div>
            <div style="border-bottom: 2px solid #ccc; margin-top: 5px"></div>
            <el-table
                    :data="songData"
                    size="small"
                    style="width: 100%"
                    @selection-change="handleSelectionChange"
            >
                <el-table-column
                        type="selection"
                        align="center"
                        width="50">
                </el-table-column>
                <el-table-column
                        label="æ­Œæ›²åç§°"
                        align="center"
                >
                    <template slot-scope="scope">
                        <a :href=`/page/front/songDetail.html?id=${scope.row.id}`>{{scope.row.name}}</a>
                    </template>
                </el-table-column>
                <el-table-column
                        prop="singer"
                        label="ä½œæ›²äºº"
                        align="center"
                >
                </el-table-column>
                <el-table-column
                        prop="lyricist"
                        label="ä½œè¯äºº"
                        align="center"
                >
                </el-table-column>
                </el-table-column>
                <el-table-column
                        prop="hot"
                        label="çƒ­åº¦ğŸ”¥"
                        align="center"
                >
                </el-table-column>

            </el-table>
            <div style="background-color: white; margin: 15px 0; text-align: center">
                <el-pagination
                        background="true"
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="pageNum"
                        :page-sizes="[10, 15, 20, 25]"
                        :page-size="pageSize"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="total">
                </el-pagination>
            </div>
        </el-col>
    </el-row>
    <el-dialog title="é€‰æ‹©ä½ è¦åŠ å…¥çš„æ­Œå•" :visible.sync="dialogFormVisible" width="30%">
        <el-form :model="form">
            <el-form-item label="æ­Œå•é€‰æ‹©" label-width="120px">
                <el-select v-model="form.listId" placeholder="è¯·é€‰æ‹©ä½ çš„æ­Œå•">
                    <el-option v-for="item in list" :label="item.name" :value="item.id"></el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">å– æ¶ˆ</el-button>
            <el-button type="primary" @click="addSongList">ç¡® å®š</el-button>
        </div>
    </el-dialog>
</div>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<script src="../../js/audio.js"></script>
<script>
    new Vue({
        el: "#wrapper",
        data: {
            pageNum: 1,
            pageSize: 10,
            total: 0,
            user: {},
            dialogFormVisible: false,
            form: {},
            // å½“å‰ç”¨æˆ·æ­Œå•
            list: [],
            // æ­Œæ‰‹id
            singerId: 0,
            // æ­Œæ‰‹ä¿¡æ¯
            singer: {},
            // æ­Œæ‰‹çš„æ­Œæ›²åˆ—è¡¨
            songData: [],
            // é€‰ä¸­å¾…åŠ å…¥æ­Œå•çš„æ­Œæ›²ä¿¡æ¯
            multipleSelection: []
        },
        created() {
            this.singerId = getUrlParamValue('id');
            // this.user = JSON.parse(localStorage.getItem("user"));
            this.getUser();
            this.loadSingerData();
            this.loadSongData();
            this.updateHot();
        },
        methods: {
            getUser() {
                $.get("/user/session").then(res => {
                    if (res.code === '0') {
                        this.user = res.data;
                        // åŠ è½½å½“å‰ç”¨æˆ·æ­Œå•ä¿¡æ¯
                        $.get("/songList/user/" + this.user.id).then(res => {
                            if (res.code === '0') {
                                this.list = res.data;
                            } else {
                                this.$message({
                                    type: "warning",
                                    message: res.msg,
                                });
                            }
                        })
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            loadSingerData() {
                $.get("/singer/" + this.singerId).then(res => {
                    if (res.code === '0') {
                        this.singer = res.data;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            loadSongData() {
                $.get("/song/page/"+this.singerId+"?pageNum=" + this.pageNum + "&pageSize=" + this.pageSize).then(res => {
                    if (res.code === '0') {
                        this.songData = res.data.content;
                        this.total = res.data.totalElements;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            handleSizeChange(pageSize) {
                this.pageSize = pageSize;
                this.loadSongData();
            },
            handleCurrentChange(pageNum) {
                this.pageNum = pageNum;
                this.loadSongData();
            },

            // è®°å½•é€‰ä¸­çš„å¾…åŠ å…¥æ­Œå•çš„å•æ›²
            handleSelectionChange(val) {
                this.multipleSelection = val;
            },
            // å¼¹å‡ºåŠ å…¥æ­Œå•çª—å£
            toggleSelection(rows) {
                // å…ˆåˆ¤æ–­ç™»å½•çŠ¶æ€ï¼Œæœªç™»å½•æç¤ºç™»å½•
                if (!this.user) {
                    this.$message({
                        type: "warning",
                        message: 'è¯·å…ˆç™»å½•',
                    });
                    return;
                }
                // åˆ¤æ–­æœ‰æ²¡æœ‰é€‰æ‹©æ­Œæ›²
                if (this.multipleSelection.length === 0) {
                    this.$message({
                        type: "warning",
                        message: 'è¯·é€‰æ‹©è¦åŠ å…¥çš„æ­Œæ›²',
                    });
                    return;
                }
                // å¼¹å‡ºçª—å£è®©ç”¨æˆ·é€‰æ‹©è‡ªå·±çš„æ­Œå•
                this.dialogFormVisible = true;
            },
            // åŠ å…¥æ­Œå•
            addSongList() {
                this.dialogFormVisible = false;
                this.form.songList = this.multipleSelection;
                $.ajax({
                    url: '/songListRel',
                    type: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify(this.form)
                }).then(res => {
                    if (res.code === '0') {
                        this.$message({
                            message: "æ·»åŠ æˆåŠŸ",
                            type: "success"
                        });
                        this.loadTable();
                    } else {
                        this.$message({
                            message: res.msg,
                            type: "error"
                        })
                    }
                })
            },
            updateHot() {
                $.get("/singer/updateHot/" + this.singerId);
            },

            logout() {
                $.get("/user/logout");
                this.user = {};
            },
        }
    });

    /**
     * è·å–urlå‚æ•°
     * @param name
     * @returns {string|null}
     */
    function getUrlParamValue(name) {
        if (name == null || name === 'undefined') {
            return 0;
        }
        let searchStr = decodeURI(location.search);
        let infoIndex = searchStr.indexOf(name + "=");
        if (infoIndex === -1) {
            return 0;
        }
        let searchInfo = searchStr.substring(infoIndex + name.length + 1);
        let tagIndex = searchInfo.indexOf("&");
        if (tagIndex !== -1) {
            searchInfo = searchInfo.substring(0, tagIndex);
        }
        return searchInfo;
    }
</script>
</body>
</html>
