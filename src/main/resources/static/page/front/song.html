<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ÁÉ≠Èó®Ê≠åÊõ≤</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/audio.css">
    <link rel="stylesheet" href="../../css/base.css">
    <style>
        [v-cloak] {
            display: none;
        }
        .nav-item:hover {
            background-color: #99ccff;
        }

        .nav-active {
            background-color: #99ccff;
        }

        .v-hd2 {
            height: 40px;
            line-height: 40px;
            padding: 0 10px 0 10px;
            font-size: 16px;
        }

        .el-input {
            width: 200px;
        }

        .el-input__inner, .el-input__icon {
            height: 30px;
            line-height: 30px;
        }
        .el-menu-item {
            overflow-x: hidden;
            overflow-y: hidden;
        }
        .el-menu-item.is-active {
            background-color: #bfeeff !important;
        }
    </style>
</head>
<body>
<div id="wrapper" v-cloak>
    <el-row>
        <div style="background-color: #0080ff; width: 100%; height: 60px;">
            <el-col :span="6">
                <!-- ÂØºËà™ -->
                <div style="height: 60px; line-height: 60px; color: white; text-align: center;">
                    <div style="padding: 0 20px; cursor: pointer">
                        <a style="color: white; font-size: 23px" href="/page/front/index.html">Èü≥‰πêÁïÖÊ∏∏ÂπøÂú∫</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="12">
                <!-- ÂØºËà™ -->
                <div style="height: 60px; line-height: 60px; color: white; display: flex; justify-content : flex-start;">
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/index.html">È¶ñÈ°µ</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/album.html">ÁÉ≠Èó®‰∏ìËæë</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item nav-active">
                        <a style="color: white" href="/page/front/song.html">ÁÉ≠Èó®Ê≠åÊõ≤</a>
                    </div>
                    <div style="padding: 0 20px; cursor: pointer; width: 100px; text-align: center" class="nav-item">
                        <a style="color: white" href="/page/front/songlist.html">Ê≠åÂçïÂàóË°®</a>
                    </div>
                    <div v-if="user && user.userId" style="padding: 0 20px; cursor: pointer" class="nav-item">
                        <a style="color: white" href="/page/end/index.html">‰∏™‰∫∫‰∏≠ÂøÉ</a>
                    </div>
                </div>
            </el-col>
            <el-col :span="6">
                <div style="line-height: 60px; text-align: right">
                    <div style="margin-right: 20px">
                        <el-input v-model="search" prefix-icon="el-icon-search" row="8" placeholder="ËØ∑ËæìÂÖ•ÂÜÖÂÆπ"></el-input>
                        <el-button type="warning" size="small" @click="loadSongData()" style="margin-right: 20px">ÊêúÁ¥¢</el-button>
                        <el-dropdown v-if="user && user.userId">
                            <img :src=`/files/${user.userAvatar}`
                                 style="width: 40px; height: 40px; margin-right: 10px; border-radius: 50%">
                            <el-dropdown-menu slot="dropdown">
                                <a href="/page/end/person.html"
                                   style="display:inline-block; padding: 5px 0; width: 100px; text-align: center; color: black">‰∏™‰∫∫‰ø°ÊÅØ</a>
                                <a @click="logout" href="#"
                                   style="display:block; width: 100px;  text-align: center; color: black">ÈÄÄÂá∫</a>
                            </el-dropdown-menu>
                        </el-dropdown>
                        <a v-else href="/page/end/login.html" style="margin-right: 30px; font-size: 15px; color: white">ÁôªÂΩï</a>
                    </div>

                </div>

            </el-col>
        </div>
    </el-row>

    <el-row type="flex" justify="center" style="margin-top: 20px">
        <el-col :span="15" offset="1">
            <div class="v-hd2" style="display: inline-block">
                Ê≠åÊõ≤ÂàóË°®
            </div>
            <div style="display: inline-block; float: right">
                <el-button
                        round
                        size="small"
                        type="success"
                        @click="toggleSelection()"
                >
                    Âä†ÂÖ•Ê≠åÂçï
                </el-button>
            </div>
            <div style="border-bottom: 2px solid #ccc; margin-top: 5px"></div>
            <el-table
                    :data="songData"
                    size="small"
                    style="width: 100%"
                    @selection-change="handleSelectionChange"
            >
                <el-table-column
                        type="selection"
                        align="center"
                        width="50">
                </el-table-column>
                <el-table-column
                        label="Ê≠åÊõ≤ÂêçÁß∞"
                        align="center"
                >
                    <template slot-scope="scope">
                        <a :href=`/page/front/songDetail.html?id=${scope.row.songId}`>{{scope.row.songName}}</a>
                    </template>
                </el-table-column>
                <el-table-column
                        label="ÊºîÂî±ËÄÖ"
                        align="center"
                >
                    <template slot-scope="scope">
                        <a :href=`/page/front/singer.html?id=${scope.row.singerId}`>{{scope.row.songSinger}}</a>
                    </template>
                </el-table-column>
                <el-table-column
                        prop="songSinger"
                        label="‰ΩúÊõ≤‰∫∫"
                        align="center"
                >
                </el-table-column>
                <el-table-column
                        prop="songLyricist"
                        label="‰ΩúËØç‰∫∫"
                        align="center"
                >
                </el-table-column>
                <el-table-column
                        label="ÊâÄÂ±û‰∏ìËæë"
                        align="center"
                >
                    <template slot-scope="scope">
                        <a :href=`/page/front/album.html?id=${scope.row.albumId}`>{{scope.row.songAlbum}}</a>
                    </template>
                </el-table-column>
                <el-table-column
                        prop="songHot"
                        label="ÁÉ≠Â∫¶üî•üî•"
                        align="center"
                >
                </el-table-column>

            </el-table>
            <div style="background-color: white; margin: 15px 0; text-align: center">
                <el-pagination
                        background="true"
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="pageNum"
                        :page-sizes="[10, 15, 20, 25]"
                        :page-size="pageSize"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="total">
                </el-pagination>
            </div>
        </el-col>
    </el-row>
    <el-dialog title="ÈÄâÊã©‰Ω†Ë¶ÅÂä†ÂÖ•ÁöÑÊ≠åÂçï" :visible.sync="dialogFormVisible" width="30%">
        <el-form :model="form">
            <el-form-item label="Ê≠åÂçïÈÄâÊã©" label-width="120px">
                <el-select v-model="form.songListRelListId" placeholder="ËØ∑ÈÄâÊã©‰Ω†ÁöÑÊ≠åÂçï">
                    <el-option v-for="item in list" :label="item.songListName" :value="item.songListId"></el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">Âèñ Ê∂à</el-button>
            <el-button type="primary" @click="addSongList">Á°Æ ÂÆö</el-button>
        </div>
    </el-dialog>
</div>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<script src="../../js/audio.js"></script>
<script>
    new Vue({
        el: "#wrapper",
        data: {
            pageNum: 1,
            pageSize: 10,
            total: 0,
            search: '',
            user: {},
            dialogFormVisible: false,
            form: {},
            // ÂΩìÂâçÁî®Êà∑Ê≠åÂçï
            list: [],
            // Ê≠åÊõ≤ÂàóË°®
            songData: [],
            // ÈÄâ‰∏≠ÂæÖÂä†ÂÖ•Ê≠åÂçïÁöÑÊ≠åÊõ≤‰ø°ÊÅØ
            multipleSelection: []
        },
        created() {
            // this.user = JSON.parse(localStorage.getItem("user"));
            let name = location.search.split("=")[1];
            if (name) {
                this.search = decodeURI(name);
            }
            this.getUser();
            this.loadSongData();
        },
        methods: {
            getUser() {
                $.get("/user/session").then(res => {
                    if (res.code === '0') {
                        this.user = res.data;
                        // Âä†ËΩΩÂΩìÂâçÁî®Êà∑Ê≠åÂçï‰ø°ÊÅØ
                        $.get("/songList/user/" + this.user.userId).then(res => {
                            if (res.code === '0') {
                                this.list = res.data;
                            } else {
                                this.$message({
                                    type: "warning",
                                    message: res.msg,
                                });
                            }
                        })
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            loadSongData() {
                let name = this.search;
                $.get("/song/page?name=" + name + "&pageNum=" + this.pageNum + "&pageSize=" + this.pageSize).then(res => {
                    if (res.code === '0') {
                        this.songData = res.data.content;
                        this.total = res.data.totalElements;
                    } else {
                        this.$message({
                            type: "warning",
                            message: res.msg,
                        });
                    }
                })
            },
            handleSizeChange(pageSize) {
                this.pageSize = pageSize;
                this.loadSongData();
            },
            handleCurrentChange(pageNum) {
                this.pageNum = pageNum;
                this.loadSongData();
            },

            // ËÆ∞ÂΩïÈÄâ‰∏≠ÁöÑÂæÖÂä†ÂÖ•Ê≠åÂçïÁöÑÂçïÊõ≤
            handleSelectionChange(val) {
                this.multipleSelection = val;
            },
            // ÂºπÂá∫Âä†ÂÖ•Ê≠åÂçïÁ™óÂè£
            toggleSelection(rows) {
                // ÂÖàÂà§Êñ≠ÁôªÂΩïÁä∂ÊÄÅÔºåÊú™ÁôªÂΩïÊèêÁ§∫ÁôªÂΩï
                if (!this.user) {
                    this.$message({
                        type: "warning",
                        message: 'ËØ∑ÂÖàÁôªÂΩï',
                    });
                    return;
                }
                // Âà§Êñ≠ÊúâÊ≤°ÊúâÈÄâÊã©Ê≠åÊõ≤
                if (this.multipleSelection.length === 0) {
                    this.$message({
                        type: "warning",
                        message: 'ËØ∑ÈÄâÊã©Ë¶ÅÂä†ÂÖ•ÁöÑÊ≠åÊõ≤',
                    });
                    return;
                }
                // ÂºπÂá∫Á™óÂè£ËÆ©Áî®Êà∑ÈÄâÊã©Ëá™Â∑±ÁöÑÊ≠åÂçï
                this.dialogFormVisible = true;
            },
            // Âä†ÂÖ•Ê≠åÂçï
            addSongList() {
                this.dialogFormVisible = false;
                this.form.songList = this.multipleSelection;
                $.ajax({
                    url: '/songListRel',
                    type: 'POST',
                    contentType: "application/json",
                    data: JSON.stringify(this.form)
                }).then(res => {
                    if (res.code === '0') {
                        this.$message({
                            message: "Ê∑ªÂä†ÊàêÂäü",
                            type: "success"
                        });
                        this.loadTable();
                    } else {
                        this.$message({
                            message: res.msg,
                            type: "error"
                        })
                    }
                })
            },

            logout() {
                $.get("/user/logout");
                this.user = {};
            },
        }
    });
</script>
</body>
</html>
